<div class="dashboard-container">
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>ü§µ‚Äç‚ôÇÔ∏è Jefe de ventas</h2>
        </div>
        <nav class="sidebar-nav">
            <button [class.active]="activeTab === 'dashboard'" (click)="changeTab('dashboard')" class="nav-item">
                üìà Dashboard
            </button>
            <button [class.active]="activeTab === 'products'" (click)="changeTab('products')" class="nav-item">
                üì¶ Productos
            </button>
            <button [class.active]="activeTab === 'sales'" (click)="changeTab('sales')" class="nav-item">
                üõí Ventas
            </button>
            <button [class.active]="activeTab === 'customers'" (click)="changeTab('customers')" class="nav-item">
                üë• Clientes
            </button>
            <button [class.active]="activeTab === 'users'" (click)="changeTab('users')" class="nav-item">
                üßë‚Äçüíº Usuarios
            </button>
            <button [class.active]="activeTab === 'marketing'" (click)="changeTab('marketing')" class="nav-item">
                üì¢ Marketing
            </button>
        </nav>
    </aside>

    <main class="main-content">
        <!-- Dashboard Overview -->
        @if (activeTab === 'dashboard') {
        <section class="dashboard-overview">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon revenue">ü™ô</div>
                    <div class="stat-info">
                        <h3>Total ventas</h3>
                        @if (statistics$ | async; as stats) {
                        <p class="stat-value">${{ stats.totalSales | number:'1.0-0' }}</p>
                        <p class="stat-change" [class.positive]="stats.salesGrowth > 0">
                            {{ stats.salesGrowth | number:'1.1-1' }}%
                        </p>
                        }
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon products">üì¶</div>
                    <div class="stat-info">
                        <h3>Productos activos</h3>
                        <p class="stat-value">{{ (statistics$ | async)?.activeProducts }}</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon customers">üë•</div>
                    <div class="stat-info">
                        <h3>Total clientes</h3>
                        <p class="stat-value">{{ (statistics$ | async)?.registeredCustomers }}</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon orders">üìã</div>
                    <div class="stat-info">
                        <h3>Ordenes pendientes</h3>
                        <p class="stat-value">{{ (statistics$ | async)?.pendingOrders }}</p>
                    </div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Tendencia de ventas</h3>
                    <!-- Add your preferred charting component here -->
                    <div class="chart-placeholder">Grafico de ventas</div>
                </div>

                <div class="chart-card">
                    <h3>Productos en tendencia</h3>
                    <div class="top-products-list">
                        @for (product of chartData.topProducts; track product.id) {
                        <div class="top-product-item">
                            <span class="product-name">{{ product.name }}</span>
                            <span class="product-sales">${{ product.sales | number:'1.0-0' }}</span>
                        </div>
                        }
                    </div>
                </div>
            </div>
        </section>
        }

        <!-- Products Section -->
        @if (activeTab === 'products') {
        <section class="products-section">
            <div class="section-header">
                <h2>Administracion de productos </h2>
                <div class="search-box">
                    <input type="text" placeholder="Buscar producto..." #productSearch
                        (input)="getFilteredProducts(productSearch.value)">
                </div>
            </div>

            <div class="data-grid">
                <thead>
                    <tr>
                        <th class="texto">Productos</th>
                        <th class="texto">Cantidad</th>
                        <th class="texto">Precio</th>
                        <th class="texto">Ventas</th>
                        <th class="texto">Estado</th>
                    </tr>
                </thead>
                <tbody>
                    @if (products$ | async; as products) {
                    @for (product of products; track product.id) {
                    <tr>
                        <td>
                            <div class="product-info">
                                <img [src]="product.image" [alt]="product.name">
                                <span>{{ product.name }}</span>
                            </div>
                        </td>
                        <td>{{ product.stock }}</td>
                        <td>${{ product.price }}</td>
                        <td>{{ product.sales }}</td>
                        <td>
                            <span [class]="'status-badge ' + product.status.toLowerCase()">
                                {{ product.status }}
                            </span>
                        </td>
                    </tr>
                    }
                    }
                </tbody>
            </div>
        </section>
        }

        <!-- Sales Section -->
        @if (activeTab === 'sales') {
        <section class="users-section">
            <div class="section-header">
                <h2>Administraci√≥n de usuarios</h2>
            </div>

            @if (usersLoading) {
            <p>Cargando usuarios...</p>
            }

            @if (usersError) {
            <div class="error-message">Error al cargar los usuarios: {{ usersError }}</div>
            }

            <div class="data-grid">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Nombre</th>
                            <th>Apellido</th>
                            <th>ID</th>
                            <th>Activo</th>
                            <th>Rol</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (users.length > 0) {
                        @for (user of users; track user.id) {
                        <tr>
                            <td>{{ user.email || 'N/A' }}</td>
                            <td>{{ user.name || 'N/A' }}</td>
                            <td>{{ user.lastname || 'N/A' }}</td>
                            <td>{{ user.id || 'N/A' }}</td>
                            <td>
                                <span [class.active-badge]="user.is_active" [class.inactive-badge]="!user.is_active">
                                    {{ user.is_active ? 'S√≠' : 'No' }}
                                </span>
                            </td>
                            <td>
                                @if (user.rol === 'vendedor') {
                                <span class="rol-badge vendedor">Vendedor</span>
                                }
                                @else {
                                <span>{{ user.rol || 'N/A' }}</span>
                                }
                            </td>
                        </tr>
                        }
                        }
                        @else {
                        <tr>
                            <td colspan="6" class="no-data">No hay usuarios disponibles</td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
        </section>

        }

        <!-- Customers Section -->
        @if (activeTab === 'customers') {
        <section class="customers-section">
            <div class="section-header">
                <h2>Administracion de clientes</h2>
                <div class="search-box">
                    <input type="text" placeholder="Search customers..." #customerSearch
                        (input)="getFilteredCustomers(customerSearch.value)">
                </div>
            </div>

            <div class="data-grid">
                <table>
                    <thead>
                        <tr>
                            <th class="texto">Cliente</th>
                            <th class="texto">Email</th>
                            <th class="texto">Orden</th>
                            <th class="texto">Total costos</th>
                            <th class="texto">Ultimo pedido</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (customers$ | async; as customers) {
                        @for (customer of customers; track customer.id) {
                        <tr>
                            <td>
                                <div class="customer-info">
                                    <span class="customer-avatar">{{ customer.name[0] }}</span>
                                    <span>{{ customer.name }}</span>
                                </div>
                            </td>
                            <td>{{ customer.email }}</td>
                            <td>{{ customer.orderCount }}</td>
                            <td>${{ customer.totalSpent | number:'1.2-2' }}</td>
                            <td>{{ customer.lastOrderDate | date:'mediumDate' }}</td>
                        </tr>
                        }
                        }
                    </tbody>
                </table>
            </div>
        </section>
        }

        <!-- Users Section -->
        @if (activeTab === 'users') {
        <section class="users-section">
            <div class="section-header">
                <h2>Administraci√≥n de usuarios</h2>
            </div>
            @if (usersLoading){
            Cargando Usuarios
            }
            @if (usersError){
            <div class="error-message">Error al cargar los usuarios: {{ usersError }}</div>
            }
            <div class="data-grid">
                <table>
                   <thead>
    <tr>
        <th>Email</th>
        <th>Nombre</th>
        <th>Apellido</th>
        <th>ID</th>
        <th>Activo</th>
        <th>Rol</th>
        <th>Acciones</th> <!-- Nueva columna -->
    </tr>
</thead>
<tbody>
    @for( user of users; track user.id) {
    <tr [class.vendedor-row]="user.rol === 'vendedor'">
        <td>{{ user.email || 'N/A' }}</td>
        <td>{{ user.name || 'N/A' }}</td>
        <td>{{ user.lastname || 'N/A' }}</td>
        <td>{{ user.id || 'N/A' }}</td>
        <td>
            <span [class.active-badge]="user.is_active" [class.inactive-badge]="!user.is_active">
                {{ user.is_active ? 'S√≠' : 'No' }}
            </span>
        </td>
        <td>
            @if(user.rol === 'vendedor'){
            <span class="rol-badge vendedor">Vendedor</span>
            }
            @if(user.rol !== 'vendedor'){
            <span>{{ user.rol || 'N/A' }}</span>
            }
        </td>
        <td>
            <button (click)="onEditRol(user)" class="edit-rol-btn">Editar rol</button>
        </td>
    </tr>
    }
    @if (users.length === 0) {
    <tr>
        <td colspan="7" class="no-data">No hay usuarios disponibles</td>
    </tr>
    }
</tbody>
                </table>
            </div>
        </section>
        }
    </main>
</div>